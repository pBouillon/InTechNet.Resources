<!-- Title -->
<h5 class="text-center mb-2">
    Distinguer le <span class="text-success">vrai</span> du <span class="text-danger">faux</span>
</h5>
<!-- /Title -->

<!-- Core content -->
<div class="row">

    <div class="col-md-8 mx-auto">

        <p class="text-justify mt-3">
            Maintenant que nous avons un peu mieux compris les m√©canismes des fake news, essayons de regarder si c'est
            si simple de diff√©rencier la v√©rit√© du mensonge !
        </p>

    </div>

</div>
<!-- /Core content -->

<!-- Subtitle -->
<div class="row">

    <h6 class="col-md-8 mx-auto mt-3">
        ‚öñÔ∏è Juger <span class="text-success">le bon article</span>
    </h6>

</div>
<!-- /Subtitle -->

<!-- Game rules -->
<div class="row">

    <div class="col-md-8 mx-auto">

        <p class="text-justify mt-3">
            Dans le jeu suivant, tu vas voir <span class="text-success">un grand th√®me et deux articles qui se
            contredisent</span> sur le sujet.
        </p>

        <p class="text-justify mt-3">
            Cliquer sur article l'ouvrira dans un nouvel onglet, √† toi de l'analyser savoir s'il s'agit d'un article de
            d√©sinformation ou d'un article s√©rieux !
        </p>

    </div>

</div>
<!-- /Game rules -->

<!-- Game flat Earth -->
<div class="row">

    <hr class="col-md-8 mx-auto mt-3" />
    
    <h6 class="lead col-md-8 mx-auto mb-3">
        üåç La Terre est plate
    </h6>

</div>

<div class="row">

    <div class="col-md-8 mx-auto row">

        <div class="col-md-6 p-1">
            <a href="http://www.legorafi.fr/2014/02/04/le-gouvernement-recule-et-autorise-la-theorie-de-la-terre-plate-a-figurer-dans-les-manuels-scolaires/"
                class="col-md-12 btn btn-outline-primary"
                target="_blank">Article pour</a>
        </div>

        <div class="col-md-6 p-1">
            <a href="https://www.nationalgeographic.fr/espace/la-terre-est-elle-vraiment-ronde"
                class="col-md-12 btn btn-outline-primary"
                target="_blank">Article contre</a>
        </div>

    </div>

</div>

<div class="row">

    <div class="col-md-8 mx-auto">

        <small class="text-muted">L'article s'ouvrira dans un nouvel onglet</small>
    
        <p class="text-justify mt-3">
            Tu penses que c'est :
        </p>

    </div>

</div>

<div class="row mt-2">

    <div class="col-md-8 mx-auto row justify-content-around btn-group-toggle" data-toggle="buttons">
    
        <label id="flat-earth-true-wrapper" class="col-12 col-md-4 mb-2 mb-md-0 btn btn-outline-success">
            <input id="flat-earth-true" type="radio" autocomplete="off"> Vrai ‚úÖ
        </label>
    
        <label id="flat-earth-false-wrapper" class="col-12 col-md-4 btn btn-outline-danger">
            <input id="flat-earth-false" type="radio" autocomplete="off"> Faux ‚ùå
        </label>
    
    </div>

</div>

<div class="row mt-2">

    <div id="flat-earth-conclusion" class="col-md-8 mx-auto">

        <p class="text-justify mt-2">
            C'est bien s√ªr <span class="text-danger">faux</span>, la Terre est ronde et nous le savons depuis un moment.
            <em>National Geographic</em> est une source tr√®s s√ªre sur l'environnement et la nature dans sa globalit√©.
        </p>

    </div>

</div>
<!-- /Game flat Earth -->

<!-- Game dangerous vaccines -->
<div class="row">

    <hr class="col-md-8 mx-auto mt-3" />

    <h6 class="lead col-md-8 mx-auto mb-3">
        üíâ Les vaccins sont un danger pour la sant√©
    </h6>

</div>

<div class="row">

    <div class="col-md-8 mx-auto row">

        <div class="col-md-6 p-1">
            <a href="http://www.legorafi.fr/2017/07/21/la-ministre-de-la-sante-annonce-un-douzieme-vaccin-pour-proteger-les-enfants-contre-les-onze-autres/"
                class="col-md-12 btn btn-outline-primary" target="_blank">Article pour</a>
        </div>

        <div class="col-md-6 p-1">
            <a href="https://professionnels.vaccination-info-service.fr/Aspects-scientifiques/Principes-et-bases-immunologiques-de-la-vaccination/Benefices-de-la-vaccination"
                class="col-md-12 btn btn-outline-primary" target="_blank">Article contre</a>
        </div>

    </div>

</div>

<div class="row">

    <div class="col-md-8 mx-auto">

        <small class="text-muted">L'article s'ouvrira dans un nouvel onglet</small>

        <p class="text-justify mt-3">
            Tu penses que c'est :
        </p>

    </div>

</div>

<div class="row mt-2">

    <div class="col-md-8 mx-auto row justify-content-around btn-group-toggle" data-toggle="buttons">

        <label id="dangerous-vaccines-true-wrapper" class="col-12 col-md-4 mb-2 mb-md-0 btn btn-outline-success">
            <input id="dangerous-vaccines-true" type="radio" autocomplete="off"> Vrai ‚úÖ
        </label>

        <label id="dangerous-vaccines-false-wrapper" class="col-12 col-md-4 btn btn-outline-danger">
            <input id="dangerous-vaccines-false" type="radio" autocomplete="off"> Faux ‚ùå
        </label>

    </div>

</div>

<div class="row mt-2">

    <div id="dangerous-vaccines-conclusion" class="col-md-8 mx-auto">
    
        <p class="text-justify mt-2">
            L√† encore c'est <span class="text-danger">faux</span>, les vaccins permettent de se prot√©ger contre des
            maladies tr√®s graves. D'ailleurs tu l'es normalement ! On pouvait voir que les informations du site pour
            les vaccins √©taient tr√®s compl√®tes, d√©taill√©es et indiquaient tr√®s bien leurs sources pour pouvoir v√©rifier
            toi-m√™me par la suite.
        </p>
    
    </div>

</div>
<!-- /Game dangerous vaccines -->

<!-- Game conclusion -->
<div class="row">

    <hr class="col-md-8 mx-auto mt-3" />

    <div id="conclusion" class="col-md-8 mx-auto">

        <p class="text-justify mt-2">
            Bravo ! Ces exemples √©taient plut√¥t simples mais dans la vraie vie √ßa
            n'est pas toujours aussi √©vident.
        </p>

        <p class="text-justify mt-3">
            Heureusement, savoir si une information est fiable ou non, c'est une
            question que beaucoup de gens se posent quotidiennement, comme les
            journalistes par exemple. Et si on allait regarder leurs conseils ?
        </p>

    </div>

</div>
<!-- /Game conclusion -->

<!-- Resource validation button -->
<div class="row justify-content-md-start justify-content-center my-5">

    <button id="btn-next" class="col-md-3 col-10 mr-md-0 offset-md-7 btn btn-success">
        Montre moi !
    </button>

</div>
<!-- /Resource validation button -->



<!-- Logic -->
<script>
    $(document).ready(() => {
        // LocalStorage keys
        const isUpdateInProgressKey = "isUpdating";
        
        const flatEarthChoice = "FlatEarth";
        const dangerousVaccinesChoice = "DangerousVaccines";

        // Initialize content when the page is loaded
        $(function () {
            setSuccessSectionsVisibility();
        });

        // Game logic --
        $("#dangerous-vaccines-false-wrapper").click(() => {
            dangerousVaccinesGame(false);
        });

        $("#dangerous-vaccines-true-wrapper").click(() => {
            dangerousVaccinesGame(true);
        });

        $("#flat-earth-false-wrapper").click(() => {
            flatEarthGame(false);
        });

        $("#flat-earth-true-wrapper").click(() => {
            flatEarthGame(true);
        });

        /**
         * @summary set the user answer for the dangerous vaccines question
         * @param {bool} areVaccinesDangerous user's opinion on the subject
         */
        function dangerousVaccinesGame(areVaccinesDangerous) {
            if (localStorage.getItem(dangerousVaccinesChoice)) {
                return;
            }

            // Set answer submitted flag
            localStorage.setItem(dangerousVaccinesChoice, areVaccinesDangerous);

            // Disable input fields
            disableDangerousVaccinesGroup();
        }

        /**
         * @summary set the user answer for the flat Earth question
         * @param {bool} areVaccinesDangerous user's opinion on the subject
         */
        function flatEarthGame(isEarthFlat) {
            if (localStorage.getItem(flatEarthChoice)) {
                return;
            }

            // Set answer submitted flag
            localStorage.setItem(flatEarthChoice, isEarthFlat);

            // Disable input fields
            disableFlatEarthGroup();
        }

        /**
         * @summary Disable "dangerous vaccines" related quiz components
         */
        function disableDangerousVaccinesGroup() {
            // Fetch components
            const dangerousVaccinesFalse = document.getElementById("dangerous-vaccines-false-wrapper");
            const dangerousVaccinesFalseButton = document.getElementById("dangerous-vaccines-false");

            const dangerousVaccinesTrue = document.getElementById("dangerous-vaccines-true-wrapper");
            const dangerousVaccinesTrueButton = document.getElementById("dangerous-vaccines-true");

            // Toggle buttons availability
            dangerousVaccinesFalse.classList.add("disabled");
            dangerousVaccinesFalseButton.disabled = true;

            dangerousVaccinesTrue.classList.add("disabled");
            dangerousVaccinesTrueButton.disabled = true;

            // Highlight the submitted answer
            if (localStorage.getItem(dangerousVaccinesChoice) === 'true') {
                dangerousVaccinesTrue.classList.replace("btn-outline-success", "btn-success");
            } else {
                dangerousVaccinesFalse.classList.replace("btn-outline-danger", "btn-danger");
            }
        }  

        /**
         * @summary Disable "flat Earth" related quiz components
         */
        function disableFlatEarthGroup() {
            // Fetch components
            const flatEarthFalse = document.getElementById("flat-earth-false-wrapper");
            const flatEarthFalseButton = document.getElementById("flat-earth-false");

            const flatEarthTrue = document.getElementById("flat-earth-true-wrapper");
            const flatEarthTrueButton = document.getElementById("flat-earth-true");

            // Toggle buttons availability
            flatEarthFalse.classList.add("disabled");
            flatEarthFalseButton.disabled = true;

            flatEarthTrue.classList.add("disabled");
            flatEarthTrueButton.disabled = true;

            // Highlight the submitted answer
            if (localStorage.getItem(flatEarthChoice) === 'true') {
                flatEarthTrue.classList.replace("btn-outline-success", "btn-success");
            } else {
                flatEarthFalse.classList.replace("btn-outline-danger", "btn-danger");
            }
        }

        /**
         * @summary display or hide each success text and elements according to
         *          the previously answered quiz questions
         */
        function setSuccessSectionsVisibility() {
            // Flat Earth visibility
            if (localStorage.getItem(flatEarthChoice)) {
                disableFlatEarthGroup();
            }

            // Vaccines visibility
            if (localStorage.getItem(dangerousVaccinesChoice)) {
                disableDangerousVaccinesGroup();
            }

            showSuccesses();
        }

        /**
         * @summary display the final success message to reach the next resource
         */
        function showSuccesses() {
            const isEarthFlat = localStorage.getItem(flatEarthChoice);
            const areVaccinesDangerous = localStorage.getItem(dangerousVaccinesChoice);

            const DangerousVaccinesConclusionElement = document.getElementById("dangerous-vaccines-conclusion");
            const flatEarthConclusionElement = document.getElementById("flat-earth-conclusion");

            if (!!areVaccinesDangerous) {
                DangerousVaccinesConclusionElement.style.display = "block";
            } else {
                DangerousVaccinesConclusionElement.style.display = "none";
            }

            if (!!isEarthFlat) {
                flatEarthConclusionElement.style.display = "block";
            } else {
                flatEarthConclusionElement.style.display = "none";
            }

            if (!isEarthFlat || !areVaccinesDangerous) {
                document.getElementById("conclusion").style.display = "none";
                document.getElementById("btn-next").style.display = "none";
                return;
            }

            document.getElementById("conclusion").style.display = "block";
            document.getElementById("btn-next").style.display = "block";
        }

        // API calls ---

        // Fetch the ID of the hub from URI
        // https://<host>/hubs/<id>/...
        // [https:][][<host>][hubs][<id>][...]
        const hubId = location.href.split("/")[4];

        // Constants for API calls
        /* const apiUrl = "http://193.50.40.81:5000/api/v1"; */ const apiUrl = "http://localhost:8080/api/v1";
        const nextResourceUrl = apiUrl + "/Pupils/me/Hubs/" + hubId + "/Modules/current/Resources/current";
        const validateResourceUrl = apiUrl + "/Pupils/me/Hubs/" + hubId + "/Modules/current/States/current";

        // Retrieve the token from the local storage
        const token = JSON.parse(localStorage.currentPupil).token;

        /**
         * @summary loads the next resource from this one and load it into the
         *          current page
         */
        function loadNextResource() {
            const xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", nextResourceUrl, false);
            xmlHttp.setRequestHeader("Authorization", "Bearer " + token);
            xmlHttp.send(null);

            const resource = JSON.parse(xmlHttp.responseText);
            document.getElementById("resource-content").innerHTML = resource.content;
        }

        /**
         * @summary validate the current resource
         */
        function validateResource() {
            const xmlHttp = new XMLHttpRequest();
            xmlHttp.open("PUT", validateResourceUrl, false);
            xmlHttp.setRequestHeader("Authorization", "Bearer " + token);
            xmlHttp.send(null);
        }

        // Event listener for the button to go to the next resource
        $("#btn-next").click(() => {
            if (localStorage.getItem(isUpdateInProgressKey)) {
                return;
            }

            localStorage.setItem(isUpdateInProgressKey, true);

            validateResource();
            loadNextResource();
        });

    });
</script>
<!-- /Logic -->
